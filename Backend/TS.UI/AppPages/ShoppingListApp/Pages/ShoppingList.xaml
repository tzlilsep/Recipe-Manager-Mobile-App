<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:shapes="clr-namespace:Microsoft.Maui.Controls.Shapes;assembly=Microsoft.Maui.Controls"
             xmlns:conv="clr-namespace:TS.AppPages.ShoppingListApp"
             x:Class="TS.AppPages.ShoppingListApp.ShoppingList"
             x:Name="Page"
             Title="רשימות קניות"
             FlowDirection="RightToLeft">

    <ContentPage.Resources>
        <x:Static x:Key="BoolInverseConverter" Member="conv:ShoppingList+BoolInverseConverter.Instance" />
    </ContentPage.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>

        <VerticalStackLayout Grid.Row="0" Padding="7" Spacing="5">
        </VerticalStackLayout>

        <ScrollView Grid.Row="1" Padding="12,0,12,88">
            <FlexLayout Wrap="Wrap"
                        Direction="Row"
                        FlowDirection="RightToLeft"
                        JustifyContent="Start"
                        AlignItems="Start"
                        AlignContent="Start"
                        VerticalOptions="Start"
                        BindableLayout.ItemsSource="{Binding Lists}">

                <BindableLayout.ItemTemplate>
                    <DataTemplate>
                        <ContentView FlexLayout.Basis="50%" Margin="0,0" FlowDirection="RightToLeft">
                            <SwipeView Padding="4" BackgroundColor="Transparent">

                                <SwipeView.LeftItems>
                                    <SwipeItems Mode="Reveal">
                                        <SwipeItem Text="מחק"
                                                   BackgroundColor="IndianRed"
                                                   Command="{Binding BindingContext.DeleteCommand, Source={RelativeSource AncestorType={x:Type ContentPage}}}"
                                                   CommandParameter="{Binding .}" />
                                    </SwipeItems>
                                </SwipeView.LeftItems>

                                <Border Stroke="{AppThemeBinding Light=#AB4E52, Dark=#333333}"
                                        StrokeThickness="1"
                                        Padding="10"
                                        Margin="4"
                                        BackgroundColor="{AppThemeBinding Light=#F7E7CE, Dark=#262626}"
                                        HorizontalOptions="Fill"
                                        VerticalOptions="Start"
                                        HeightRequest="160">
                                    <Border.StrokeShape>
                                        <shapes:RoundRectangle CornerRadius="12" />
                                    </Border.StrokeShape>

                                    <Grid RowDefinitions="Auto,*">
                                        <Grid.GestureRecognizers>
                                            <TapGestureRecognizer Command="{Binding BindingContext.OpenListCommand, Source={RelativeSource AncestorType={x:Type ContentPage}}}"
                                                                  CommandParameter="{Binding .}" />
                                        </Grid.GestureRecognizers>

                                        <Label Grid.Row="0"
                                               Text="{Binding Name}"
                                               FontSize="18"
                                               FontAttributes="Bold"
                                               LineBreakMode="TailTruncation"
                                               MaxLines="1"
                                               HorizontalTextAlignment="Start"
                                               HorizontalOptions="Fill" />

                                        <ContentView Grid.Row="1" HeightRequest="90" Clip="True">
                                            <Grid>
                                                <VerticalStackLayout Spacing="2"
                                                                     IsVisible="{Binding IsEmpty, Converter={StaticResource BoolInverseConverter}}"
                                                                     BindableLayout.ItemsSource="{Binding FirstItems}">
                                                    <BindableLayout.ItemTemplate>
                                                        <DataTemplate>
                                                            <Grid ColumnDefinitions="*,Auto"
                                                                  FlowDirection="RightToLeft"
                                                                  Padding="0"
                                                                  ColumnSpacing="6"
                                                                  HeightRequest="20">
                                                                <Label Grid.Column="0"
                                                                       Text="{Binding Text}"
                                                                       FontSize="14"
                                                                       Opacity="0.9"
                                                                       TextColor="{AppThemeBinding Light=#444, Dark=#DDD}"
                                                                       HorizontalTextAlignment="Start"
                                                                       HorizontalOptions="Fill"
                                                                       VerticalOptions="Center" />
                                                                <CheckBox Grid.Column="1"
                                                                          IsChecked="{Binding IsChecked}"
                                                                          IsEnabled="False"
                                                                          VerticalOptions="Center"
                                                                          Scale="0.8" />
                                                            </Grid>
                                                        </DataTemplate>
                                                    </BindableLayout.ItemTemplate>
                                                </VerticalStackLayout>

                                                <Grid IsVisible="{Binding IsEmpty}" />
                                            </Grid>
                                        </ContentView>
                                    </Grid>
                                </Border>
                            </SwipeView>
                        </ContentView>
                    </DataTemplate>
                </BindableLayout.ItemTemplate>
            </FlexLayout>
        </ScrollView>

        <Grid Padding="12"
              Grid.RowSpan="2"
              HorizontalOptions="End"
              VerticalOptions="End">
            <Button Text="+"
                    WidthRequest="64"
                    HeightRequest="64"
                    FontSize="32"
                    CornerRadius="32"
                    Command="{Binding AddListCommand}"
                    BackgroundColor="{AppThemeBinding Light=#AB4E52, Dark=#2E7D32}"
                    Shadow="5,5,5,Grey"
                    TextColor="White"
                    SemanticProperties.Hint="הוסף רשימה חדשה" />
        </Grid>
    </Grid>
</ContentPage>
